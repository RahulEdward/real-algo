import{a,j as e}from"./vendor-react-Bde5w1iN.js";import{T as L}from"./search-BXjqKZLA.js";import{U as R}from"./UnderlyingSelector-DjoW0y42.js";import{B as I,t as d}from"./index-BajzrNI3.js";import{C as o,b as u,c as g,a as l}from"./card-mz1ygTyE.js";import{L as w,aE as D}from"./vendor-icons-Do0RMBwc.js";import{R as E,B as _,C as v,X as B,Y as F,T as M,L as U,e as f,f as y}from"./vendor-charts-DMFZZfud.js";import"./vendor-router-BFkrKKjM.js";import"./label-sTsobr-L.js";import"./vendor-radix-DxOrs8Le.js";import"./select-DfeukBJp.js";function W(){const[c,C]=a.useState("NFO"),[r,S]=a.useState(""),[i,N]=a.useState(""),[x,m]=a.useState(!1),[p,P]=a.useState([]),[s,b]=a.useState(null),[t,O]=a.useState(null),T=async()=>{if(!r||!i){d.error("Please select underlying and expiry");return}m(!0);try{const[h,k]=await Promise.all([fetch("/oitracker/api/oi-data",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({underlying:r,exchange:c,expiry_date:i})}),fetch("/oitracker/api/maxpain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({underlying:r,exchange:c,expiry_date:i})})]),n=await h.json(),j=await k.json();n.status==="success"?(P(n.data||[]),O(n.spot_price||null)):d.error(n.message||"Failed to fetch OI data"),j.status==="success"&&b(j.max_pain||null)}catch{d.error("Failed to fetch OI data")}finally{m(!1)}};return e.jsxs(L,{title:"OI Tracker",description:"Real-time open interest changes with Max Pain calculation",children:[e.jsxs(o,{className:"mb-6",children:[e.jsx(u,{children:e.jsx(g,{children:"Select Parameters"})}),e.jsxs(l,{className:"space-y-4",children:[e.jsx(R,{exchange:c,underlying:r,expiry:i,onExchangeChange:C,onUnderlyingChange:S,onExpiryChange:N}),e.jsxs(I,{onClick:T,disabled:x,children:[x&&e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),"Fetch OI Data"]})]})]}),(s||t)&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 mb-6",children:[s&&e.jsx(o,{children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Max Pain:"}),e.jsxs("span",{className:"text-xl font-bold",children:["₹",s.toLocaleString()]})]})})}),t&&e.jsx(o,{children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Spot Price:"}),e.jsxs("span",{className:"text-xl font-bold",children:["₹",t.toLocaleString()]})]})})})]}),p.length>0&&e.jsxs(o,{children:[e.jsx(u,{children:e.jsx(g,{children:"Open Interest Distribution"})}),e.jsx(l,{children:e.jsx("div",{className:"h-[500px]",children:e.jsx(E,{width:"100%",height:"100%",children:e.jsxs(_,{data:p,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(B,{dataKey:"strike"}),e.jsx(F,{}),e.jsx(M,{}),e.jsx(U,{}),s&&e.jsx(f,{x:s,stroke:"orange",strokeDasharray:"5 5",label:"Max Pain"}),t&&e.jsx(f,{x:t,stroke:"blue",strokeDasharray:"5 5",label:"Spot"}),e.jsx(y,{dataKey:"call_oi",name:"Call OI",fill:"#22c55e"}),e.jsx(y,{dataKey:"put_oi",name:"Put OI",fill:"#ef4444"})]})})})})]})]})}export{W as default};
